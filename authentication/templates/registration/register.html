{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Registro de Usuario{% endblock %}

{% block content %}
<div class="max-w-md mx-auto mt-10 p-8 bg-white rounded-2xl shadow-md">
  <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Registro de usuario</h2>

  <form method="post" enctype="multipart/form-data" novalidate class="space-y-5">
    {% csrf_token %}

    <!-- Nombre de usuario -->
    <div>
      <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-gray-700">Nombre de usuario</label>
      {{ form.username|add_class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500" }}
      {% if form.username.errors %}
        <p class="text-red-500 text-sm">{{ form.username.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Email -->
    <div>
      <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700">Correo electrónico</label>
      {{ form.email|add_class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500" }}
      {% if form.email.errors %}
        <p class="text-red-500 text-sm">{{ form.email.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Foto -->
    <div>
      <label for="{{ form.foto.id_for_label }}" class="block text-sm font-medium text-gray-700">Foto de perfil (opcional)</label>
      {{ form.foto|add_class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500" }}
      {% if form.foto.errors %}
        <p class="text-red-500 text-sm">{{ form.foto.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Contraseña -->
    <div>
      <label for="{{ form.password1.id_for_label }}" class="block text-sm font-medium text-gray-700">Contraseña</label>
      {{ form.password1|add_class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500" }}

      <!-- Caja dinámica de requisitos -->
      <div class="mt-3 bg-orange-50 border-l-4 border-orange-400 p-3 rounded-lg shadow-sm">
        <h3 class="text-sm font-semibold text-orange-700">Requisitos de la contraseña:</h3>
        <ul id="password-requirements" class="mt-2 text-xs text-gray-600 space-y-1">
          <li id="req-length" class="flex items-center"><span class="mr-1">❌</span> Al menos 8 caracteres</li>
          <li id="req-number" class="flex items-center"><span class="mr-1">❌</span> Incluir al menos un número</li>
          <li id="req-letter" class="flex items-center"><span class="mr-1">❌</span> Incluir al menos una letra</li>
        </ul>
      </div>

      {% if form.password1.errors %}
        <p class="text-red-500 text-sm">{{ form.password1.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Confirmación de contraseña -->
    <div>
      <label for="{{ form.password2.id_for_label }}" class="block text-sm font-medium text-gray-700">Confirmar contraseña</label>
      {{ form.password2|add_class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500" }}
      {% if form.password2.errors %}
        <p class="text-red-500 text-sm">{{ form.password2.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Botón -->
    <button id="submit-btn" type="submit" 
            class="w-full bg-orange-500 text-white font-semibold py-2.5 rounded-lg shadow hover:bg-orange-600 transition disabled:opacity-50 disabled:cursor-not-allowed">
      Registrarse
    </button>
  </form>

  <p class="mt-4 text-center text-gray-600">
    ¿Ya tienes cuenta? 
    <a href="{% url 'authentication:login' %}" class="text-orange-500 font-semibold hover:underline">
      Iniciar sesión
    </a>
  </p>
</div>

<script>
  const passwordInput = document.getElementById("id_password1");
  const submitBtn = document.getElementById("submit-btn");

  const reqLength = document.getElementById("req-length");
  const reqNumber = document.getElementById("req-number");
  const reqLetter = document.getElementById("req-letter");

  function validatePassword() {
    const value = passwordInput.value;
    let valid = true;

    // Longitud mínima
    if (value.length >= 8) {
      reqLength.innerHTML = '<span class="text-green-500 mr-1">✔</span> Al menos 8 caracteres';
    } else {
      reqLength.innerHTML = '<span class="text-red-500 mr-1">❌</span> Al menos 8 caracteres';
      valid = false;
    }

    // Número
    if (/\d/.test(value)) {
      reqNumber.innerHTML = '<span class="text-green-500 mr-1">✔</span> Incluir al menos un número';
    } else {
      reqNumber.innerHTML = '<span class="text-red-500 mr-1">❌</span> Incluir al menos un número';
      valid = false;
    }

    // Letra
    if (/[a-zA-Z]/.test(value)) {
      reqLetter.innerHTML = '<span class="text-green-500 mr-1">✔</span> Incluir al menos una letra';
    } else {
      reqLetter.innerHTML = '<span class="text-red-500 mr-1">❌</span> Incluir al menos una letra';
      valid = false;
    }

    // Bloquear o habilitar botón
    submitBtn.disabled = !valid;
  }

  passwordInput.addEventListener("input", validatePassword);
</script>
{% endblock %}
