{% extends "base.html" %}

{% block title %}Buscar usuarios y recetas ‚Äì FoodieNet{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-6">
  <h1 class="text-3xl font-bold mb-6 text-center">üîç Buscar usuarios y recetas</h1>

  <!-- FORMULARIO DE B√öSQUEDA -->
  <form method="get" class="flex gap-2 mb-8">
    <input 
      type="text" 
      name="query" 
      value="{{ query }}" 
      placeholder="Buscar usuarios y recetas..." 
      class="flex-1 px-4 py-2 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-green-400 focus:outline-none"
    />
    <button 
      type="submit" 
      class="px-4 py-2 bg-green-500 text-white rounded-xl shadow hover:bg-green-600 transition"
    >
      Buscar
    </button>
  </form>

  <!-- RESULTADOS USUARIOS -->
  <h2 class="text-2xl font-semibold mb-4">üë• Usuarios</h2>
  {% if page_obj_usuarios and page_obj_usuarios.object_list %}
    <ul class="space-y-4">
      {% for u in page_obj_usuarios.object_list %}
        <li class="flex items-center gap-4 p-4 bg-white rounded-xl shadow hover:shadow-md transition">
          <a href="{% url 'users:perfil_usuario' u.username %}" class="flex items-center gap-4 w-full">
            <img src="{{ u.perfil.foto.url }}" 
                 alt="Foto de {{ u.username }}" 
                 class="w-12 h-12 rounded-full object-cover border" />
            <div>
              <p class="font-semibold text-gray-900">{{ u.username }}</p>
              <p class="text-sm text-gray-600">
                {{ u.perfil.biografia|default:"(sin biograf√≠a)"|truncatechars:60 }}
              </p>
            </div>
          </a>
        </li>
      {% endfor %}
    </ul>

    <!-- Paginaci√≥n usuarios -->
    <div class="flex justify-center mt-6">
      <ul class="flex items-center gap-2">
        {% if page_obj_usuarios.has_previous %}
          <li>
            <a href="?query={{ query }}&page_usuarios={{ page_obj_usuarios.previous_page_number }}&page_recetas={{ page_obj_recetas.number }}" 
               class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300">&laquo;</a>
          </li>
        {% endif %}

        {% for num in page_obj_usuarios.paginator.page_range %}
          {% if num == page_obj_usuarios.number %}
            <li><span class="px-3 py-1 rounded-lg bg-green-500 text-white">{{ num }}</span></li>
          {% elif num >= page_obj_usuarios.number|add:'-2' and num <= page_obj_usuarios.number|add:'2' %}
            <li>
              <a href="?query={{ query }}&page_usuarios={{ num }}&page_recetas={{ page_obj_recetas.number }}" 
                 class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300">{{ num }}</a>
            </li>
          {% endif %}
        {% endfor %}

        {% if page_obj_usuarios.has_next %}
          <li>
            <a href="?query={{ query }}&page_usuarios={{ page_obj_usuarios.next_page_number }}&page_recetas={{ page_obj_recetas.number }}" 
               class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300">&raquo;</a>
          </li>
        {% endif %}
      </ul>
    </div>
  {% else %}
    <p class="text-gray-600 italic">No se encontraron usuarios.</p>
  {% endif %}

  <hr class="my-8 border-gray-300">

  <!-- RESULTADOS RECETAS -->
  <h2 class="text-2xl font-semibold mb-4">üç≤ Recetas</h2>
  {% if page_obj_recetas and page_obj_recetas.object_list %}
    <ul class="space-y-4">
      {% for receta in page_obj_recetas.object_list %}
        <li class="p-4 bg-white rounded-xl shadow hover:shadow-md transition">
          <a href="{% url 'detalle_receta' receta.pk %}" class="block text-lg font-semibold text-green-600 hover:underline">
            {{ receta.titulo }}
          </a>
          <p class="text-sm text-gray-600 mt-1">
            {{ receta.descripcion|default:"Sin descripci√≥n"|truncatechars:100 }}
          </p>
        </li>
      {% endfor %}
    </ul>

    <!-- Paginaci√≥n recetas -->
    <div class="flex justify-center mt-6">
      <ul class="flex items-center gap-2">
        {% if page_obj_recetas.has_previous %}
          <li>
            <a href="?query={{ query }}&page_usuarios={{ page_obj_usuarios.number }}&page_recetas={{ page_obj_recetas.previous_page_number }}" 
               class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300">&laquo;</a>
          </li>
        {% endif %}

        {% for num in page_obj_recetas.paginator.page_range %}
          {% if num == page_obj_recetas.number %}
            <li><span class="px-3 py-1 rounded-lg bg-green-500 text-white">{{ num }}</span></li>
          {% elif num >= page_obj_recetas.number|add:'-2' and num <= page_obj_recetas.number|add:'2' %}
            <li>
              <a href="?query={{ query }}&page_usuarios={{ page_obj_usuarios.number }}&page_recetas={{ num }}" 
                 class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300">{{ num }}</a>
            </li>
          {% endif %}
        {% endfor %}

        {% if page_obj_recetas.has_next %}
          <li>
            <a href="?query={{ query }}&page_usuarios={{ page_obj_usuarios.number }}&page_recetas={{ page_obj_recetas.next_page_number }}" 
               class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300">&raquo;</a>
          </li>
        {% endif %}
      </ul>
    </div>
  {% else %}
    <p class="text-gray-600 italic">No se encontraron recetas.</p>
  {% endif %}
</div>
{% endblock %}
