{% extends "base.html" %}
{% load filtros_amigos %}

{% block title %}Perfil de {{ otro.username }}{% endblock %}

{% block content %}
  <h2>Perfil de {{ otro.username }}</h2>

  <img src="{{ perfil_otro.foto.url }}" alt="Foto de {{ otro.username }}" width="100" style="border-radius:50%;">

  {% if request.user|es_amigo:otro %}
    <p>Ya sois amigos</p>
  {% elif solicitud_enviada %}
    <p id="estado-solicitud">Solicitud pendiente</p>
  {% else %}
    <form id="form-solicitud" method="post" action="{% url 'users:enviar_solicitud' otro.username %}">
      {% csrf_token %}
      <button type="submit">Enviar solicitud de amistad</button>
    </form>
  {% endif %}

  <p>Biografía: {{ perfil_otro.biografia|default:"(sin biografía)" }}</p>

  <h3>Recetas públicas</h3>
  {% if recetas %}
    <ul>
      {% for r in recetas %}
        <li>
          <a href="{% url 'detalle_receta' r.pk %}">{{ r.titulo }}</a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No tiene recetas públicas.</p>
  {% endif %}

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
  $(document).ready(function(){
    $('#form-solicitud').submit(function(e){
      e.preventDefault();
      let form = $(this);
      $.ajax({
        url: form.attr('action'),
        type: 'POST',
        data: form.serialize(),
        success: function(){
          form.replaceWith('<p id="estado-solicitud">Solicitud pendiente</p>');
        },
        error: function(){
          alert('Error al enviar la solicitud');
        }
      });
    });
  });
  </script>
{% endblock %}
